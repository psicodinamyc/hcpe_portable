<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolución - HCPE</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    
    <!-- Header -->
    <header class="bg-light py-2 mb-2 border-bottom no-print">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="text-center flex-grow-1">
                    <h1 class="display-6 fw-bold mb-1">EVOLUCIÓN / SEGUIMIENTO CLÍNICO</h1>
                    <div class="doctor-info">
                        <p class="mb-0" style="font-size: 0.85rem;"><strong>Dr. Mauricio Villamandos - Médico Especialista en Psiquiatría - M.N.: 134131</strong></p>
                        <p class="mb-0" style="font-size: 0.75rem;"><strong>Resistencia, Chaco – Argentina | infopsicodinamyc@gmail.com | Teléfono: 3765 041832</strong></p>
                    </div>
                </div>
                <div>
                    <button class="btn btn-outline-primary btn-sm" onclick="window.open('pacientes.html', '_blank')" title="Ver listado de pacientes">
                        <i class="fas fa-users"></i> Pacientes
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <form id="evolucionForm">
            
            <!-- Sección 1: Datos del Paciente -->
            <section class="form-section">
                <h2>1. Identificación del Paciente</h2>
                
                <!-- Información de la consulta -->
                <div class="form-grid">
                    <div class="form-group">
                        <label>1A. Lugar de evaluación:</label>
                        <input type="text" id="lugarEvaluacion" class="form-control" value="Resistencia, Chaco">
                    </div>
                    <div class="form-group">
                        <label>1B. Fecha de sesión:</label>
                        <input type="datetime-local" id="fechaSesion" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>1C. Modalidad:</label>
                        <select id="modalidad" class="form-control">
                            <option value="presencial">Presencial</option>
                            <option value="virtual">Virtual</option>
                            <option value="domicilio">Domicilio</option>
                            <option value="urgencia">Urgencia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>1D. Código del paciente:</label>
                        <input type="text" id="codigoPaciente" class="form-control" readonly>
                    </div>
                </div>
                
                <!-- Datos personales -->
                <div class="form-grid">
                    <div class="form-group">
                        <label>1E. Nombre:</label>
                        <input type="text" id="nombre" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1F. Apellido:</label>
                        <input type="text" id="apellido" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1G. DNI:</label>
                        <div class="input-group">
                            <input type="text" id="dniPaciente" class="form-control" placeholder="Ingrese DNI">
                            <button type="button" class="btn btn-primary btn-sm" onclick="buscarYCargarPaciente()" title="Buscar paciente">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>1H. Nacionalidad:</label>
                        <input type="text" id="nacionalidad" class="form-control" readonly>
                    </div>
                </div>
                
                <!-- Datos demográficos -->
                <div class="form-grid">
                    <div class="form-group">
                        <label>1I. Sexo/género:</label>
                        <input type="text" id="sexo" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1J. Fecha de nacimiento:</label>
                        <input type="text" id="fechaNacimiento" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1K. Edad actual:</label>
                        <input type="text" id="edadPaciente" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1L. Estado civil:</label>
                        <input type="text" id="estadoCivil" class="form-control" readonly>
                    </div>
                </div>
                
                <!-- Información de contacto -->
                <div class="form-grid">
                    <div class="form-group">
                        <label>1M. Domicilio:</label>
                        <input type="text" id="domicilio" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1N. C.P.:</label>
                        <input type="text" id="codigoPostal" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1O. Celular:</label>
                        <input type="text" id="telefono" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>1P. Email:</label>
                        <input type="text" id="email" class="form-control" readonly>
                    </div>
                </div>

                <div class="row g-3 mt-3">
                    <div class="col-12">
                        <button type="button" class="btn btn-info btn-sm" onclick="verHistorialEvoluciones()">
                            <i class="fas fa-history"></i> Ver Historial de Evoluciones
                        </button>
                        <button type="button" class="btn btn-success btn-sm" onclick="abrirHistoriaClinica()">
                            <i class="fas fa-folder-open"></i> Abrir Historia Clínica
                        </button>
                    </div>
                </div>
            </section>

            <!-- Sección 2: Motivo de Consulta Actual -->
            <section class="form-section">
                <h2>2. Motivo de Consulta Actual</h2>
                
                <div class="form-group">
                    <label>¿Por qué consulta hoy? / Motivo principal:</label>
                    <div class="voice-controls">
                        <button type="button" class="btn btn-sm btn-danger" onclick="iniciarDictado('motivoConsulta')" title="Dictar">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-info" onclick="leerCampo('motivoConsulta')" title="Leer">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    <textarea id="motivoConsulta" class="form-control" rows="3" placeholder="Registre el motivo principal de esta consulta..."></textarea>
                </div>
            </section>

            <!-- Sección 3: Estado Clínico Actual -->
            <section class="form-section">
                <h2>3. Estado Clínico Actual</h2>
                
                <div class="row g-3">
                    <div class="col-md-12">
                        <label class="form-label">Estado de ánimo:</label>
                        <select id="estadoAnimo" class="form-control">
                            <option value="">Seleccione...</option>
                            <option value="eutimico">Eutímico</option>
                            <option value="depresivo">Depresivo</option>
                            <option value="ansioso">Ansioso</option>
                            <option value="irritable">Irritable</option>
                            <option value="eufórico">Eufórico</option>
                            <option value="disfórico">Disfórico</option>
                            <option value="lábil">Lábil</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label>Síntomas presentes hoy:</label>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_insomnio">
                                <label class="form-check-label" for="sint_insomnio">Insomnio</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_anhedonia">
                                <label class="form-check-label" for="sint_anhedonia">Anhedonia</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_irritabilidad">
                                <label class="form-check-label" for="sint_irritabilidad">Irritabilidad</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_fatiga">
                                <label class="form-check-label" for="sint_fatiga">Fatiga</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_ansiedad">
                                <label class="form-check-label" for="sint_ansiedad">Ansiedad</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_panico">
                                <label class="form-check-label" for="sint_panico">Ataques de pánico</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_ideacion_suicida">
                                <label class="form-check-label" for="sint_ideacion_suicida">Ideación suicida</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_alucinaciones">
                                <label class="form-check-label" for="sint_alucinaciones">Alucinaciones</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_delirios">
                                <label class="form-check-label" for="sint_delirios">Delirios</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_desorganizacion">
                                <label class="form-check-label" for="sint_desorganizacion">Desorganización</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_alteracion_apetito">
                                <label class="form-check-label" for="sint_alteracion_apetito">Alteración del apetito</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sint_otros">
                                <label class="form-check-label" for="sint_otros">Otros</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label>Observaciones clínicas:</label>
                    <div class="voice-controls">
                        <button type="button" class="btn btn-sm btn-danger" onclick="iniciarDictado('observacionesClinics')" title="Dictar">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-info" onclick="leerCampo('observacionesClinics')" title="Leer">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    <textarea id="observacionesClinics" class="form-control" rows="4" placeholder="Describa el estado clínico actual del paciente..."></textarea>
                </div>
            </section>

            <!-- Sección 4: Evaluación de Tratamiento -->
            <section class="form-section">
                <h2>4. Evaluación del Tratamiento</h2>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Adherencia al tratamiento:</label>
                        <select id="adherencia" class="form-control">
                            <option value="">Seleccione...</option>
                            <option value="buena">Buena - Cumple adecuadamente</option>
                            <option value="parcial">Parcial - Olvidos ocasionales</option>
                            <option value="irregular">Irregular - Frecuentes olvidos</option>
                            <option value="nula">Nula - No toma medicación</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">Respuesta al tratamiento:</label>
                        <select id="respuestaTratamiento" class="form-control">
                            <option value="">Seleccione...</option>
                            <option value="excelente">Excelente - Mejoría significativa</option>
                            <option value="buena">Buena - Mejoría moderada</option>
                            <option value="leve">Leve - Mejoría leve</option>
                            <option value="nula">Nula - Sin cambios</option>
                            <option value="empeoramiento">Empeoramiento</option>
                        </select>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label>¿Presenta efectos adversos?</label>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_ninguno">
                                <label class="form-check-label" for="ea_ninguno">Ninguno</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_somnolencia">
                                <label class="form-check-label" for="ea_somnolencia">Somnolencia</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_insomnio">
                                <label class="form-check-label" for="ea_insomnio">Insomnio</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_nauseas">
                                <label class="form-check-label" for="ea_nauseas">Náuseas</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_cefalea">
                                <label class="form-check-label" for="ea_cefalea">Cefalea</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_mareos">
                                <label class="form-check-label" for="ea_mareos">Mareos</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_disfuncion_sexual">
                                <label class="form-check-label" for="ea_disfuncion_sexual">Disfunción sexual</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_aumento_peso">
                                <label class="form-check-label" for="ea_aumento_peso">Aumento de peso</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_temblor">
                                <label class="form-check-label" for="ea_temblor">Temblor</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ea_otros">
                                <label class="form-check-label" for="ea_otros">Otros</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label>Tratamiento actual (medicación):</label>
                    <div class="voice-controls">
                        <button type="button" class="btn btn-sm btn-danger" onclick="iniciarDictado('tratamientoActual')" title="Dictar">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-info" onclick="leerCampo('tratamientoActual')" title="Leer">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    <textarea id="tratamientoActual" class="form-control" rows="3" placeholder="Liste la medicación actual con dosis..."></textarea>
                </div>

                <div class="form-group">
                    <label>Ajustes de tratamiento realizados hoy:</label>
                    <div class="voice-controls">
                        <button type="button" class="btn btn-sm btn-danger" onclick="iniciarDictado('ajustesTratamiento')" title="Dictar">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-info" onclick="leerCampo('ajustesTratamiento')" title="Leer">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    <textarea id="ajustesTratamiento" class="form-control" rows="3" placeholder="Registre cambios en la medicación, ajustes de dosis, etc..."></textarea>
                </div>
            </section>

            <!-- Sección 5: Plan para Próxima Sesión -->
            <section class="form-section">
                <h2>5. Plan para Próxima Sesión</h2>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Próxima cita:</label>
                        <input type="date" id="proximaCita" class="form-control">
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">Intervalo de seguimiento:</label>
                        <select id="intervaloSeguimiento" class="form-control">
                            <option value="">Seleccione...</option>
                            <option value="semanal">Semanal</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="mensual">Mensual</option>
                            <option value="trimestral">Trimestral</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label>Indicaciones y recomendaciones:</label>
                    <div class="voice-controls">
                        <button type="button" class="btn btn-sm btn-danger" onclick="iniciarDictado('indicaciones')" title="Dictar">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-info" onclick="leerCampo('indicaciones')" title="Leer">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    <textarea id="indicaciones" class="form-control" rows="3" placeholder="Indicaciones para el paciente hasta la próxima consulta..."></textarea>
                </div>

                <div class="form-group">
                    <label>Observaciones adicionales:</label>
                    <div class="voice-controls">
                        <button type="button" class="btn btn-sm btn-danger" onclick="iniciarDictado('observacionesAdicionales')" title="Dictar">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-info" onclick="leerCampo('observacionesAdicionales')" title="Leer">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    <textarea id="observacionesAdicionales" class="form-control" rows="2"></textarea>
                </div>
            </section>

            <!-- Botones de acción -->
            <div class="button-group no-print">
                <button type="button" class="btn btn-success" onclick="guardarEvolucion()">
                    <i class="fas fa-save"></i> Guardar Evolución
                </button>
                <button type="button" class="btn btn-primary" onclick="exportarEvolucionWord()">
                    <i class="fas fa-file-word"></i> Exportar a Word
                </button>
                <button type="button" class="btn btn-info" onclick="window.print()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button type="button" class="btn btn-warning" onclick="nuevaEvolucion()">
                    <i class="fas fa-file"></i> Nueva Evolución
                </button>
                <button type="button" class="btn btn-secondary btn-sm" onclick="exportarBackupDesdeEvol()" title="Exportar backup completo">
                    <i class="fas fa-download"></i> Backup
                </button>
                <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('importarBackupInputEvol').click()" title="Importar backup">
                    <i class="fas fa-upload"></i> Restore
                </button>
            </div>
            <input type="file" id="importarBackupInputEvol" accept=".json" style="display: none;" onchange="importarBackupDesdeEvol(event)">

            <!-- Footer con firma digital -->
            <section class="signature-section mt-5">
                <div class="text-center">
                    <img src="images/firma_digital.png" alt="Firma Digital" style="max-width: 300px; margin: 0 auto; display: block;">
                    <p class="mt-3"><strong>Dr. Mauricio Villamandos</strong></p>
                    <p>Médico Especialista en Psiquiatría</p>
                    <p>M.N.: 134131</p>
                    <p class="text-muted small">Resistencia, Chaco - Argentina</p>
                </div>
            </section>

        </form>

        <!-- Modal para historial de evoluciones -->
        <div class="modal fade" id="historialModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Historial de Evoluciones</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="listaHistorial">
                            <!-- Se cargará dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script principal -->
    <script src="js/evolucion.js"></script>
</body>
</html>
